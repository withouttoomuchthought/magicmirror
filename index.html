<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>magicmirror 🪞✨</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Comfortaa:wght@500;600;700&family=Inter:wght@400;500;600&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            /* Serene Blues & Purples Palette (deeper flow) */
            --sky-deep: #1B2250;
            --sky-bright: #83BCD4;
            --sky-light: #B1DEE0;
            --lavender: #9389BD;
            --periwinkle: #CFCAD1;
            --background: #F8FAFB;
            
            /* Soft text colors (research-recommended) */
            --text-primary: #2d3748;
            --text-secondary: rgba(45, 55, 72, 0.6);
            
            /* Gradient variables - deeper blues/purples */
            --gradient-1: #B8A8D8;  /* deeper purple */
            --gradient-2: #A8B8E8;  /* deeper blue */
            --gradient-3: #B8A8E8;  /* deeper lavender */
            --gradient-4: #C8B8E8;  /* soft purple */
            
            /* Typography (research: Comfortaa titles, Inter body) */
            --font-title: 'Comfortaa', sans-serif;
            --font-body: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            
            /* Responsive font sizes */
            --font-h1-mobile: 28px;
            --font-h2-mobile: 22px;
            --font-body-mobile: 16px;
            --font-h1-desktop: 40px;
            --font-h2-desktop: 32px;
            --font-body-desktop: 18px;
            
            /* Line heights for calm (research: 1.6 minimum for body) */
            --line-height-title: 1.2;
            --line-height-body: 1.6;
            
            /* Font weights - avoid extremes */
            --weight-regular: 400;
            --weight-medium: 500;
            --weight-semibold: 600;
            
            /* 8-point spacing scale (research-recommended rhythm) */
            --space-xs: 8px;
            --space-sm: 16px;
            --space-md: 24px;
            --space-lg: 32px;
            --space-xl: 48px;
            --space-2xl: 64px;
            
            /* Soft visual elements (research specs) */
            --radius-sm: 8px;
            --radius-md: 16px;
            --radius-lg: 24px;
            --radius-round: 50px;
            --shadow-soft: 0 4px 20px rgba(0, 0, 0, 0.08);
            --shadow-float: 0 8px 30px rgba(0, 0, 0, 0.12);
            
            /* Cloud glow for UI text */
            --glow-soft: 0 0 20px rgba(255, 255, 255, 0.6),
                         0 0 40px rgba(232, 227, 255, 0.4),
                         0 0 60px rgba(200, 180, 255, 0.2);
            --glow-strong: 0 0 20px rgba(255, 255, 255, 0.8),
                           0 0 40px rgba(232, 227, 255, 0.6),
                           0 0 60px rgba(200, 180, 255, 0.4),
                           0 0 80px rgba(180, 200, 255, 0.2);
        }

        body {
            font-family: var(--font-body);
            font-size: var(--font-body-mobile);
            line-height: var(--line-height-body);
            color: var(--text-primary);
            background: linear-gradient(135deg, var(--gradient-1) 0%, var(--gradient-2) 35%, var(--gradient-3) 65%, var(--gradient-4) 100%);
            background-size: 400% 400%;
            animation: gradientFlow 20s ease infinite;
            background-attachment: fixed;
            min-height: 100vh;
            padding: var(--space-md);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow-x: hidden;
            cursor: none;
            /* Font smoothing for softer appearance (research-recommended) */
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            text-rendering: optimizeLegibility;
        }
        
        /* Desktop: 18px body text for optimal readability */
        @media (min-width: 1024px) {
            body {
                font-size: var(--font-body-desktop);
            }
        }

        /* Show default cursor on touch devices */
        @media (hover: none) and (pointer: coarse) {
            body {
                cursor: auto !important;
            }
        }

        /* ========================================
           CUSTOM CURSOR
        ======================================== */
        .custom-cursor {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.9);
            position: fixed;
            pointer-events: none;
            z-index: 99999;
            box-shadow: 0 0 15px rgba(212, 197, 226, 0.6);
            transition: transform 0.15s ease;
        }

        .cursor-follower {
            width: 35px;
            height: 35px;
            border: 2px solid rgba(212, 197, 226, 0.4);
            border-radius: 50%;
            position: fixed;
            pointer-events: none;
            z-index: 99998;
            transition: transform 0.2s ease;
        }

        /* Hide custom cursor on touch devices */
        @media (hover: none) and (pointer: coarse) {
            .custom-cursor,
            .cursor-follower {
                display: none !important;
            }
        }

        /* ========================================
           AURORA LIGHT BEAMS
        ======================================== */
        .aurora-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
            overflow: hidden;
        }

        .aurora-beam {
            position: absolute;
            width: 300px;
            height: 200%;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(232, 214, 255, 0.15) 50%, 
                transparent 100%);
            filter: blur(40px);
            transform-origin: top center;
            animation: auroraMove 20s ease-in-out infinite;
        }

        .aurora-beam:nth-child(1) { left: 10%; animation-delay: 0s; }
        .aurora-beam:nth-child(2) { left: 30%; animation-delay: 4s; }
        .aurora-beam:nth-child(3) { left: 50%; animation-delay: 8s; }
        .aurora-beam:nth-child(4) { left: 70%; animation-delay: 12s; }
        .aurora-beam:nth-child(5) { left: 90%; animation-delay: 16s; }

        @keyframes auroraMove {
            0% {
                opacity: 0;
                transform: translateX(-100%) translateY(0) rotate(-15deg);
            }
            15% { opacity: 0.6; }
            85% { opacity: 0.6; }
            100% {
                opacity: 0;
                transform: translateX(100%) translateY(50vh) rotate(-15deg);
            }
        }

        /* ========================================
           RIPPLE CANVAS
        ======================================== */
        #rippleCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 2;
        }

        /* ========================================
           PARTICLE SYSTEM
        ======================================== */
        .particle-system {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 3;
            overflow: hidden;
        }

        .particle {
            position: absolute;
            border-radius: 50%;
            animation: floatParticle linear infinite;
            opacity: 0;
        }

        .particle.slow {
            width: 2px;
            height: 2px;
            background: rgba(255, 255, 255, 0.6);
            box-shadow: 0 0 3px rgba(255, 255, 255, 0.8);
        }

        .particle.fast {
            width: 3px;
            height: 3px;
            background: rgba(212, 197, 226, 0.7);
            box-shadow: 0 0 5px rgba(212, 197, 226, 0.9);
        }

        .particle.glow {
            width: 5px;
            height: 5px;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.9), rgba(249, 228, 166, 0.5));
            box-shadow: 0 0 10px rgba(249, 228, 166, 0.8);
        }

        @keyframes floatParticle {
            0% {
                transform: translateY(100vh) translateX(0) scale(0) rotate(0deg);
                opacity: 0;
            }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% {
                transform: translateY(-100px) translateX(var(--particle-drift)) scale(1) rotate(360deg);
                opacity: 0;
            }
        }

        /* ========================================
           CLOUD SYSTEM (3 LAYERS)
        ======================================== */
        .cloud-layer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
        }

        .cloud-layer-back { z-index: 4; }
        .cloud-layer-mid { z-index: 5; }
        .cloud-layer-front { z-index: 6; }

        .parallax-cloud {
            position: absolute;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 50% 40% 45% 55% / 55% 45% 50% 50%;
            filter: blur(25px);
            animation: driftParallax linear infinite;
            opacity: 0;
        }

        .quote-cloud {
            position: absolute;
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(15px);
            border-radius: var(--radius-lg);
            padding: var(--space-sm) var(--space-md);
            font-family: var(--font-body);
            font-size: 0.7em;
            font-style: italic;
            color: rgba(45, 55, 72, 0.35);
            line-height: var(--line-height-body);
            text-align: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.04);
            animation: driftQuoteCloud linear infinite;
            opacity: 0;
            max-width: 200px;
        }

        @keyframes driftParallax {
            0% {
                transform: translateX(-10%) translateY(100vh) rotate(0deg);
                opacity: 0;
            }
            10% { opacity: var(--cloud-opacity); }
            90% { opacity: var(--cloud-opacity); }
            100% {
                transform: translateX(var(--cloud-drift)) translateY(-100px) rotate(var(--cloud-rotate));
                opacity: 0;
            }
        }

        @keyframes driftQuoteCloud {
            0% {
                transform: translateX(-5%) translateY(100vh) rotate(0deg) scale(0.9);
                opacity: 0;
            }
            10% { opacity: 0.6; }
            90% { opacity: 0.6; }
            100% {
                transform: translateX(var(--quote-drift)) translateY(-80px) rotate(var(--quote-rotate)) scale(1);
                opacity: 0;
            }
        }

        /* ========================================
           SPARKLE INTERVALS
        ======================================== */
        .sparkle-float {
            position: fixed;
            font-size: 12px;
            pointer-events: none;
            z-index: 7;
            animation: sparkleFloat 8s ease-in-out forwards;
        }

        @keyframes sparkleFloat {
            0%, 100% { 
                opacity: 0; 
                transform: translate(0, 0) rotate(0deg) scale(0.8); 
            }
            15% { opacity: 0.6; }
            50% { 
                opacity: 0.9; 
                transform: translate(50px, -70px) rotate(180deg) scale(1.3); 
            }
            85% { opacity: 0.5; }
        }

        /* ========================================
           MAIN ANIMATIONS
        ======================================== */
        @keyframes gradientFlow {
            0%, 100% { background-position: 0% 50%; }
            25% { background-position: 50% 100%; }
            50% { background-position: 100% 50%; }
            75% { background-position: 50% 0%; }
        }

        @keyframes holoShift {
            0%, 100% { background-position: 0% center; }
            50% { background-position: 200% center; }
        }

        @keyframes logoFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-8px); }
        }

        @keyframes emojiRotate {
            0%, 100% {
                transform: scale(1) rotate(0deg);
            }
            50% {
                transform: scale(1.15) rotate(10deg);
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes breathe {
            0%, 100% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.3); opacity: 0.8; }
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.4; }
            50% { opacity: 1; }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-5px); }
        }

        @keyframes shimmerSweep {
            0%, 100% {
                transform: translateX(-100%) translateY(-100%);
            }
            50% {
                transform: translateX(100%) translateY(100%);
            }
        }

        /* ========================================
           MAIN CONTAINER
        ======================================== */
        .container {
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
            position: relative;
            z-index: 10;
            transition: transform 0.3s ease;
            transform-style: preserve-3d;
        }

        .view {
            display: none;
            animation: fadeIn 1s ease;
        }

        .view.active {
            display: block;
        }

        /* ========================================
           LOGO & HEADER
        ======================================== */
        .invitation-text {
            font-family: var(--font-body);
            font-size: 1.05em;
            line-height: var(--line-height-body);
            margin-bottom: var(--space-lg);
            text-align: center;
            color: var(--text-secondary);
            font-style: italic;
            animation: fadeIn 1.5s ease;
            text-shadow: var(--glow-soft);
        }

        .logo {
            font-family: var(--font-title);
            font-weight: var(--weight-semibold);
            text-transform: lowercase;
            letter-spacing: 1px;
            font-style: normal;
            margin-bottom: var(--space-sm);
            text-align: center;
            font-size: var(--font-h1-mobile);
            animation: logoFloat 4s ease-in-out infinite;
        }
        
        @media (min-width: 1024px) {
            .logo {
                font-size: var(--font-h1-desktop);
            }
        }

        .logo-text {
            background: linear-gradient(
                90deg,
                #F8F3FF 0%,
                #FFF8FA 15%,
                #F3FFFA 30%,
                #FFFCF8 45%,
                #FFF8FA 60%,
                #F8F3FF 75%,
                #FFFCF8 90%,
                #F8F3FF 100%
            );
            background-size: 300% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: holoShift 8s ease-in-out infinite;
            filter: drop-shadow(0 0 30px rgba(255, 255, 255, 0.8))
                    drop-shadow(0 0 50px rgba(229, 217, 242, 0.7))
                    drop-shadow(0 0 70px rgba(200, 180, 255, 0.5))
                    drop-shadow(0 0 90px rgba(180, 200, 255, 0.3));
        }

        .emoji {
            display: inline-block;
            margin-left: 8px;
            animation: emojiRotate 5s ease-in-out infinite;
            font-size: 1.2em;
            filter: drop-shadow(0 0 15px rgba(249, 228, 166, 0.8));
        }

        .tagline {
            font-family: var(--font-body);
            font-size: 1em;
            line-height: var(--line-height-body);
            margin-bottom: var(--space-xl);
            opacity: 0.8;
            text-align: center;
            text-shadow: var(--glow-soft);
        }

        /* ========================================
           GLASS CARD WITH SHIMMER
        ======================================== */
        .glass-card {
            background: rgba(255, 255, 255, 0.35);
            backdrop-filter: blur(30px) saturate(180%);
            -webkit-backdrop-filter: blur(30px) saturate(180%);
            border-radius: var(--radius-md);
            padding: var(--space-lg) var(--space-md);
            box-shadow: 
                var(--shadow-soft),
                0 0 0 1px rgba(255, 255, 255, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.8),
                0 0 60px rgba(200, 180, 255, 0.15),
                0 0 80px rgba(180, 200, 255, 0.1);
            border: 2px solid;
            border-image: linear-gradient(
                135deg, 
                rgba(255, 200, 255, 0.3),
                rgba(200, 220, 255, 0.3),
                rgba(220, 200, 255, 0.3),
                rgba(255, 220, 240, 0.3)
            ) 1;
            border-radius: var(--radius-md);
            position: relative;
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .glass-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                45deg,
                transparent 30%,
                rgba(255, 255, 255, 0.3) 50%,
                transparent 70%
            );
            animation: shimmerSweep 8s ease-in-out infinite;
            pointer-events: none;
        }

        .glass-card:hover {
            transform: translateY(-2px);
            box-shadow: 
                0 15px 50px rgba(0, 0, 0, 0.1),
                0 0 0 1px rgba(255, 255, 255, 0.5),
                inset 0 1px 0 rgba(255, 255, 255, 0.9),
                0 0 70px rgba(200, 180, 255, 0.2),
                0 0 90px rgba(180, 200, 255, 0.15);
        }

        /* ========================================
           FORM ELEMENTS
        ======================================== */
        textarea {
            width: 100%;
            min-height: 180px;
            padding: var(--space-md);
            border: none;
            border-radius: var(--radius-md);
            background: rgba(255, 255, 255, 0.5);
            font-family: var(--font-body);
            font-size: 1em;
            line-height: var(--line-height-body);
            resize: none;
            color: var(--text-primary);
            box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.03);
            transition: all 0.3s ease;
            -webkit-appearance: none;
        }

        textarea:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.75);
            box-shadow: 
                inset 0 3px 20px rgba(200, 180, 255, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 1),
                0 0 0 4px rgba(220, 200, 255, 0.2),
                var(--shadow-soft);
            transform: scale(1.01);
        }

        textarea::placeholder {
            color: #999;
            font-style: italic;
            transition: opacity 0.4s ease;
        }

        .submit-btn {
            margin-top: var(--space-md);
            padding: var(--space-sm) var(--space-xl);
            background: linear-gradient(135deg, #E8D8B8 0%, #D8C8A8 100%);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.6);
            border-radius: var(--radius-round);
            font-family: var(--font-body);
            font-size: 1em;
            font-weight: var(--weight-medium);
            cursor: pointer;
            text-transform: lowercase;
            transition: all 0.3s ease;
            box-shadow: 
                0 8px 25px rgba(232, 216, 184, 0.3),
                0 0 30px rgba(255, 240, 200, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.5);
            width: 100%;
            -webkit-appearance: none;
            position: relative;
            overflow: hidden;
            animation: subtleGlow 3s ease-in-out infinite;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.3),
                         0 0 20px rgba(232, 216, 184, 0.2);
        }

        @keyframes subtleGlow {
            0%, 100% {
                box-shadow: 
                    0 8px 25px rgba(232, 216, 184, 0.3),
                    0 0 30px rgba(255, 240, 200, 0.2),
                    inset 0 1px 0 rgba(255, 255, 255, 0.5);
            }
            50% {
                box-shadow: 
                    0 8px 30px rgba(232, 216, 184, 0.4),
                    0 0 40px rgba(255, 240, 200, 0.35),
                    inset 0 1px 0 rgba(255, 255, 255, 0.6);
            }
        }

        .submit-btn:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 
                0 12px 35px rgba(232, 216, 184, 0.5),
                0 0 50px rgba(255, 240, 200, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.7);
            animation: none;
        }

        .submit-btn:active {
            transform: scale(0.98);
        }

        .submit-btn::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                45deg,
                transparent 30%,
                rgba(255, 255, 255, 0.4) 50%,
                transparent 70%
            );
            animation: buttonShimmer 4s ease-in-out infinite;
            pointer-events: none;
        }

        @keyframes buttonShimmer {
            0%, 100% {
                transform: translateX(-100%) translateY(-100%);
            }
            50% {
                transform: translateX(100%) translateY(100%);
            }
        }

        .footer-note {
            margin-top: var(--space-lg);
            font-family: var(--font-body);
            font-size: 0.9em;
            color: var(--text-secondary);
            font-style: italic;
            line-height: var(--line-height-body);
            text-align: center;
            text-shadow: var(--glow-soft);
        }

        /* ========================================
           LOADING VIEW
        ======================================== */
        .breathing-circle {
            width: 70px;
            height: 70px;
            margin: 0 auto var(--space-md);
            border-radius: 50%;
            background: rgba(212, 197, 226, 0.5);
            animation: breathe 3s ease-in-out infinite;
        }

        .loading-text {
            font-family: var(--font-body);
            font-size: 1.05em;
            color: var(--text-secondary);
            font-style: italic;
            text-align: center;
            transition: opacity 0.4s ease;
            text-shadow: var(--glow-soft);
        }

        .loading-emoji {
            font-size: 1.5em;
            margin-top: 15px;
            text-align: center;
            animation: pulse 2s ease infinite, float 3s ease-in-out infinite;
        }

        /* ========================================
           RESULT VIEW
        ======================================== */
        .section-label {
            font-family: var(--font-body);
            font-size: 0.85em;
            text-transform: lowercase;
            color: var(--text-secondary);
            margin-bottom: var(--space-sm);
            text-shadow: var(--glow-soft);
        }

        .user-input-box {
            font-family: var(--font-body);
            font-size: 0.95em;
            line-height: var(--line-height-body);
            color: var(--text-secondary);
            font-style: italic;
            padding: var(--space-md);
            background: rgba(184, 197, 176, 0.15);
            border-radius: var(--radius-md);
            border-left: 3px solid rgba(184, 197, 176, 0.6);
            margin-bottom: var(--space-md);
        }

        .divider {
            border: none;
            border-top: 1px solid rgba(0,0,0,0.08);
            margin: var(--space-md) 0;
        }

        .transformed-box {
            font-family: var(--font-body);
            font-size: 1.1em;
            line-height: var(--line-height-body);
            color: var(--text-primary);
            text-transform: lowercase;
            padding: var(--space-lg);
            background: linear-gradient(135deg, rgba(232, 227, 255, 0.4) 0%, rgba(255, 232, 245, 0.4) 50%, rgba(227, 255, 250, 0.4) 100%);
            border-radius: var(--radius-md);
            font-style: italic;
            white-space: pre-line;
            margin-bottom: var(--space-md);
            box-shadow: inset 0 1px 3px rgba(255, 255, 255, 0.5);
            text-shadow: 0 0 15px rgba(255, 255, 255, 0.5),
                         0 0 30px rgba(232, 227, 255, 0.3),
                         0 0 45px rgba(200, 180, 255, 0.15);
        }

        .signature {
            font-family: var(--font-body);
            font-size: 0.7em;
            color: var(--text-secondary);
            font-style: italic;
            text-align: center;
            padding-top: var(--space-sm);
            border-top: 1px solid rgba(0,0,0,0.05);
        }

        .action-buttons {
            margin-top: var(--space-md);
            display: flex;
            flex-direction: column;
            gap: var(--space-sm);
        }

        .action-btn {
            padding: var(--space-sm) var(--space-md);
            background: rgba(255, 255, 255, 0.6);
            border: 2px solid rgba(212, 197, 226, 0.4);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            -webkit-appearance: none;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.03);
        }

        .action-btn:active {
            transform: scale(0.98);
            background: linear-gradient(135deg, rgba(212, 197, 226, 0.3), rgba(249, 228, 166, 0.3));
        }

        .action-icon {
            font-size: 1.3em;
            flex-shrink: 0;
        }

        .action-content {
            flex: 1;
        }

        .action-title {
            font-family: var(--font-body);
            font-weight: var(--weight-semibold);
            font-size: 1em;
            margin-bottom: 3px;
            text-transform: lowercase;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.4),
                         0 0 20px rgba(232, 227, 255, 0.2);
        }

        .action-desc {
            font-family: var(--font-body);
            font-size: 0.85em;
            color: var(--text-secondary);
            font-style: italic;
        }

        .try-again-btn {
            margin-top: var(--space-md);
            padding: var(--space-sm) var(--space-lg);
            background: transparent;
            color: var(--text-secondary);
            border: 2px solid rgba(212, 197, 226, 0.4);
            border-radius: var(--radius-round);
            font-family: var(--font-body);
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: lowercase;
            width: 100%;
            -webkit-appearance: none;
        }

        .try-again-btn:active {
            transform: scale(0.98);
            background: linear-gradient(135deg, rgba(212, 197, 226, 0.2), rgba(249, 228, 166, 0.2));
        }

        /* ========================================
           BUY ME A COFFEE - FLOATING BUTTON
        ======================================== */
        .bmac-button {
            position: fixed;
            bottom: var(--space-sm);
            left: var(--space-sm);
            background: rgba(255, 255, 255, 0.45);
            backdrop-filter: blur(20px);
            padding: var(--space-sm) var(--space-md);
            border-radius: var(--radius-round);
            border: 2px solid rgba(249, 228, 166, 0.3);
            font-family: var(--font-body);
            font-size: 0.85em;
            color: var(--text-secondary);
            text-decoration: none;
            font-style: italic;
            z-index: 100;
            display: flex;
            align-items: center;
            gap: var(--space-xs);
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(249, 228, 166, 0.2);
        }

        .bmac-button:hover {
            transform: translateY(-2px);
            background: rgba(255, 255, 255, 0.65);
            box-shadow: 0 6px 20px rgba(249, 228, 166, 0.35);
        }

        .bmac-button .bmac-emoji {
            font-size: 1.2em;
            animation: none;
            margin: 0;
            filter: none;
        }

        /* ========================================
           BUY ME A COFFEE - RESULT VIEW BOX
        ======================================== */
        .support-box {
            margin-top: var(--space-md);
            padding: var(--space-md);
            background: rgba(249, 228, 166, 0.15);
            border-radius: var(--radius-md);
            text-align: center;
            border: 2px solid rgba(249, 228, 166, 0.3);
            transition: all 0.3s ease;
        }

        .support-box:hover {
            background: rgba(249, 228, 166, 0.2);
            border-color: rgba(249, 228, 166, 0.4);
        }

        .support-text {
            font-family: var(--font-body);
            font-size: 0.9em;
            color: var(--text-secondary);
            font-style: italic;
            margin-bottom: var(--space-sm);
            line-height: var(--line-height-body);
        }

        .support-link {
            display: inline-block;
            padding: var(--space-sm) var(--space-lg);
            background: linear-gradient(135deg, #F9E4A6 0%, #E8D596 100%);
            color: var(--text-primary);
            border-radius: var(--radius-round);
            text-decoration: none;
            font-family: var(--font-body);
            font-size: 0.95em;
            font-weight: var(--weight-medium);
            transition: all 0.3s ease;
            border: 2px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 4px 12px rgba(249, 228, 166, 0.3);
        }

        .support-link:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 18px rgba(249, 228, 166, 0.4);
        }

        /* ========================================
           FOOTER LINK
        ======================================== */
        .wtmt-link {
            position: fixed;
            bottom: var(--space-sm);
            right: var(--space-sm);
            font-family: var(--font-body);
            font-size: 0.75em;
            color: var(--text-secondary);
            text-decoration: none;
            font-style: italic;
            z-index: 100;
        }

        /* ========================================
           RESPONSIVE
        ======================================== */
        @media (max-width: 480px) {
            body { padding: var(--space-sm); }
            .logo { font-size: var(--font-h2-desktop); }
            .glass-card { padding: var(--space-md) var(--space-sm); }
            textarea { min-height: 150px; font-size: 1em; }
            .transformed-box { font-size: 1.05em; padding: var(--space-md); }
            .quote-cloud { font-size: 0.7em; max-width: 160px; }
            .bmac-button {
                padding: 10px var(--space-sm);
                font-size: 0.75em;
            }
        }

        /* ========================================
           REDUCED MOTION SUPPORT
        ======================================== */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
            
            .cloud-layer,
            .particle-system,
            .aurora-container {
                display: none;
            }
        }
    </style>
</head>
<body>
    <!-- Custom Cursor (desktop only) -->
    <div class="custom-cursor"></div>
    <div class="cursor-follower"></div>

    <!-- Aurora Light Beams -->
    <div class="aurora-container">
        <div class="aurora-beam"></div>
        <div class="aurora-beam"></div>
        <div class="aurora-beam"></div>
        <div class="aurora-beam"></div>
        <div class="aurora-beam"></div>
    </div>

    <!-- Ripple Canvas -->
    <canvas id="rippleCanvas"></canvas>

    <!-- Particle System (3 tiers) -->
    <div id="particleSystem" class="particle-system"></div>

    <!-- Cloud Layers (3 layers) -->
    <div id="cloudLayerBack" class="cloud-layer cloud-layer-back"></div>
    <div id="cloudLayerMid" class="cloud-layer cloud-layer-mid"></div>
    <div id="cloudLayerFront" class="cloud-layer cloud-layer-front"></div>

    <!-- Main Container -->
    <div class="container" id="mainContainer">
        
        <!-- Submission View -->
        <div id="submissionView" class="view active">
            <div class="invitation-text">
                close your eyes, take a breath.<br>
                now — tell the mirror what's real.
            </div>
            <div class="logo">
                <span class="logo-text">magicmirror</span><span class="emoji">🪞✨</span>
            </div>
            <p class="tagline">
                your truth, transformed withouttoomuchthought.
            </p>

            <div class="glass-card">
                <textarea id="userInput" placeholder="tell me what you're feeling..." maxlength="500"></textarea>
                <button class="submit-btn" onclick="submitThought()">
                    transform 🪞✨
                </button>
            </div>

            <p class="footer-note">
                write what's true.<br>
                messy. honest. unfiltered.<br>
                there's no wrong way to feel here.<br><br>
                you're safe, you're seen, you're held. 💛
            </p>
        </div>

        <!-- Loading View -->
        <div id="loadingView" class="view">
            <div class="breathing-circle"></div>
            <p class="loading-text">holding your words gently...</p>
            <div class="loading-emoji">🪞✨</div>
        </div>

        <!-- Result View -->
        <div id="resultView" class="view">
            <div class="glass-card">
                <div class="section-label">you wrote:</div>
                <div class="user-input-box" id="userInputDisplay"></div>
                
                <div class="divider"></div>
                
                <div class="section-label">here's what we hear you saying 🪞✨</div>
                <div class="transformed-box" id="transformedText"></div>
                <div class="signature">
                    transformed with love by magicmirror | @withouttoomuchthought + claude creation 🪞✨
                </div>
                
                <p style="font-size: 0.75em; color: rgba(58, 58, 58, 0.6); font-style: italic; text-align: center; margin-top: 15px; line-height: 1.5;">
                    these reflections come from ai. take what resonates, leave what doesn't. trust your own truth first 💛
                </p>

                <div class="action-buttons">
                    <button class="action-btn" onclick="shareToSocial()">
                        <div class="action-icon">🌸</div>
                        <div class="action-content">
                            <div class="action-title">share your truth</div>
                            <div class="action-desc">tiktok story, instagram, anywhere you want</div>
                        </div>
                    </button>

                    <button class="action-btn" onclick="downloadArt()">
                        <div class="action-icon">🎨</div>
                        <div class="action-content">
                            <div class="action-title">download as art</div>
                            <div class="action-desc">save this as a beautiful reminder</div>
                        </div>
                    </button>
                </div>

                <!-- Buy Me a Coffee - Result View Integration -->
                <div class="support-box">
                    <p class="support-text">
                        if this reflection held something for you,<br>
                        you can help keep this space free 🕯️
                    </p>
                    <a href="https://buymeacoffee.com/withouttoomuchthought" target="_blank" class="support-link">
                        leave a little light ✨
                    </a>
                </div>

                <button class="try-again-btn" onclick="tryAgain()">
                    share another truth 🪞
                </button>
            </div>
        </div>

    </div>

    <!-- Buy Me a Coffee - Floating Button -->
    <a href="https://buymeacoffee.com/withouttoomuchthought" class="bmac-button" target="_blank">
        <span class="bmac-emoji">☕️</span>
        <span>support this space</span>
    </a>

    <a href="https://www.withouttoomuchthought.com" class="wtmt-link">withouttoomuchthought.com</a>

    <script>
        // ========================================
        // CONFIGURATION
        // ========================================
        
        // 🔧 REPLACE THIS WITH YOUR CLOUDFLARE WORKER URL
        const WEBHOOK_URL = 'https://magicmirror.withouttoomuchthought.workers.dev/';
        
        // 🛠️ DEBUG MODE: add ?debug=true to URL
        const DEBUG = new URLSearchParams(window.location.search).get('debug') === 'true';
        
        function log(...args) {
            if (DEBUG) console.log('[magicmirror]', ...args);
        }

        // ========================================
        // DEBUG PANEL (shows with ?debug=true)
        // ========================================
        
        if (DEBUG) {
            const panel = document.createElement('div');
            panel.innerHTML = `
                <div id="debugPanel" style="position: fixed; bottom: 10px; left: 10px; 
                            background: rgba(0,0,0,0.95); color: #0f0; 
                            padding: 15px; border-radius: 8px; 
                            font-family: monospace; font-size: 11px; 
                            max-width: 400px; z-index: 999999; 
                            border: 1px solid #0f0; cursor: move;">
                    <div style="margin-bottom: 8px; color: #fff; font-weight: bold;">🔧 DEBUG PANEL</div>
                    <div id="debugWebhook" style="margin: 4px 0;">Webhook: Ready</div>
                    <div id="debugStatus" style="margin: 4px 0;">Status: Idle</div>
                    <div id="debugResponse" style="margin: 4px 0; max-height: 100px; overflow-y: auto; word-break: break-all;">Response: None</div>
                    <div id="debugError" style="margin: 4px 0; color: #f00;">Errors: None</div>
                    <div id="debugTime" style="margin: 4px 0;">Time: --</div>
                    <div id="debugParticles" style="margin: 4px 0;">Particles: Loading...</div>
                    <div id="debugClouds" style="margin: 4px 0;">Clouds: Loading...</div>
                </div>
            `;
            document.body.appendChild(panel);
            
            // Make draggable
            const debugPanel = document.getElementById('debugPanel');
            let isDragging = false;
            let currentX, currentY, initialX, initialY;
            
            debugPanel.addEventListener('mousedown', (e) => {
                isDragging = true;
                initialX = e.clientX - debugPanel.offsetLeft;
                initialY = e.clientY - debugPanel.offsetTop;
            });
            
            document.addEventListener('mousemove', (e) => {
                if (isDragging) {
                    e.preventDefault();
                    currentX = e.clientX - initialX;
                    currentY = e.clientY - initialY;
                    debugPanel.style.left = currentX + 'px';
                    debugPanel.style.top = currentY + 'px';
                    debugPanel.style.bottom = 'auto';
                }
            });
            
            document.addEventListener('mouseup', () => {
                isDragging = false;
            });
            
            window.updateDebug = function(key, value) {
                const el = document.getElementById('debug' + key);
                if (el) {
                    if (key === 'Response' && typeof value === 'object') {
                        el.textContent = key + ': ' + JSON.stringify(value, null, 2);
                    } else {
                        el.textContent = key + ': ' + value;
                    }
                }
            };
            
            updateDebug('Webhook', WEBHOOK_URL);
            
            console.log('🪞 magicmirror debug mode enabled');
            console.log('Worker URL:', WEBHOOK_URL);
        }

        // ========================================
        // TIME-BASED GRADIENTS
        // ========================================
        
        function setTimeBasedGradient() {
            const hour = new Date().getHours();
            const root = document.documentElement;
            
            if (hour >= 6 && hour < 12) {
                // Morning: soft blue-purple dawn
                root.style.setProperty('--gradient-1', '#C8B8E8');
                root.style.setProperty('--gradient-2', '#B8C8E8');
                root.style.setProperty('--gradient-3', '#B8D8E8');
                root.style.setProperty('--gradient-4', '#C8C8E8');
            } else if (hour >= 12 && hour < 18) {
                // Afternoon: bright blue-lavender sky
                root.style.setProperty('--gradient-1', '#A8B8E8');
                root.style.setProperty('--gradient-2', '#B8A8E8');
                root.style.setProperty('--gradient-3', '#A8C8E8');
                root.style.setProperty('--gradient-4', '#B8B8E8');
            } else if (hour >= 18 && hour < 22) {
                // Evening: deep twilight purples
                root.style.setProperty('--gradient-1', '#9888C8');
                root.style.setProperty('--gradient-2', '#8898D8');
                root.style.setProperty('--gradient-3', '#9888D8');
                root.style.setProperty('--gradient-4', '#A898D8');
            } else {
                // Night: rich deep blue-purples
                root.style.setProperty('--gradient-1', '#7868A8');
                root.style.setProperty('--gradient-2', '#6878B8');
                root.style.setProperty('--gradient-3', '#7868B8');
                root.style.setProperty('--gradient-4', '#8878B8');
            }
        }
        
        setTimeBasedGradient();
        setInterval(setTimeBasedGradient, 3600000); // Update hourly

        // ========================================
        // ROTATING PLACEHOLDER TEXT
        // ========================================
        
        const prompts = [
            "tell me what you're feeling...",
            "what's on your heart?",
            "what are you carrying today?",
            "what truth wants to be held?",
            "what's been heavy lately?",
            "what do you need to release?"
        ];
        
        let promptIndex = 0;
        const textarea = document.getElementById('userInput');
        
        function rotatePrompt() {
            textarea.placeholder = prompts[promptIndex];
            promptIndex = (promptIndex + 1) % prompts.length;
        }
        
        setInterval(rotatePrompt, 4000);

        // ========================================
        // SEQUENTIAL LOADING MESSAGES
        // ========================================
        
        const loadingMessages = [
            "holding your words gently...",
            "seeing what you didn't say...",
            "listening for your truth...",
            "reflecting back your heart...",
            "finding the right words..."
        ];
        
        let messageIndex = 0;
        let messageInterval;
        
        function showSequentialLoading() {
            const loadingText = document.querySelector('.loading-text');
            messageIndex = 0;
            loadingText.textContent = loadingMessages[0];
            
            messageInterval = setInterval(() => {
                messageIndex = (messageIndex + 1) % loadingMessages.length;
                loadingText.style.opacity = '0';
                
                setTimeout(() => {
                    loadingText.textContent = loadingMessages[messageIndex];
                    loadingText.style.opacity = '1';
                }, 400);
            }, 2500);
        }
        
        function hideSequentialLoading() {
            clearInterval(messageInterval);
        }

        // ========================================
        // CUSTOM CURSOR (desktop only)
        // ========================================
        
        const cursor = document.querySelector('.custom-cursor');
        const cursorFollower = document.querySelector('.cursor-follower');
        
        let mouseX = 0, mouseY = 0;
        let cursorX = 0, cursorY = 0;
        let followerX = 0, followerY = 0;
        
        document.addEventListener('mousemove', (e) => {
            mouseX = e.clientX;
            mouseY = e.clientY;
        });
        
        function animateCursor() {
            // Smooth follow for main cursor
            cursorX += (mouseX - cursorX) * 0.2;
            cursorY += (mouseY - cursorY) * 0.2;
            cursor.style.left = cursorX + 'px';
            cursor.style.top = cursorY + 'px';
            
            // Slower follow for follower circle
            followerX += (mouseX - followerX) * 0.1;
            followerY += (mouseY - followerY) * 0.1;
            cursorFollower.style.left = followerX + 'px';
            cursorFollower.style.top = followerY + 'px';
            
            requestAnimationFrame(animateCursor);
        }
        
        animateCursor();

        // ========================================
        // RIPPLE EFFECT ON CLICK
        // ========================================
        
        const rippleCanvas = document.getElementById('rippleCanvas');
        const rippleCtx = rippleCanvas.getContext('2d');
        let ripples = [];
        
        function resizeRippleCanvas() {
            rippleCanvas.width = window.innerWidth;
            rippleCanvas.height = window.innerHeight;
        }
        
        resizeRippleCanvas();
        window.addEventListener('resize', resizeRippleCanvas);
        
        document.addEventListener('click', (e) => {
            ripples.push({
                x: e.clientX,
                y: e.clientY,
                radius: 0,
                maxRadius: 150,
                alpha: 1
            });
        });
        
        function animateRipples() {
            rippleCtx.clearRect(0, 0, rippleCanvas.width, rippleCanvas.height);
            
            ripples = ripples.filter(ripple => {
                ripple.radius += 3;
                ripple.alpha -= 0.015;
                
                if (ripple.alpha <= 0) return false;
                
                rippleCtx.beginPath();
                rippleCtx.arc(ripple.x, ripple.y, ripple.radius, 0, Math.PI * 2);
                rippleCtx.strokeStyle = `rgba(212, 197, 226, ${ripple.alpha * 0.5})`;
                rippleCtx.lineWidth = 2;
                rippleCtx.stroke();
                
                return true;
            });
            
            requestAnimationFrame(animateRipples);
        }
        
        animateRipples();

        // ========================================
        // 3D CARD TILT
        // ========================================
        
        const mainContainer = document.getElementById('mainContainer');
        
        // Desktop: Mouse tilt
        mainContainer.addEventListener('mousemove', (e) => {
            if (window.innerWidth > 768) {
                const rect = mainContainer.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                const centerX = rect.width / 2;
                const centerY = rect.height / 2;
                
                const rotateX = (y - centerY) / 30;
                const rotateY = (centerX - x) / 30;
                
                mainContainer.style.transform = 
                    `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg)`;
            }
        });
        
        mainContainer.addEventListener('mouseleave', () => {
            mainContainer.style.transform = 'perspective(1000px) rotateX(0) rotateY(0)';
        });
        
        // Mobile: Gyroscope tilt
        if (window.DeviceOrientationEvent && /Mobile|Android|iPhone|iPad/i.test(navigator.userAgent)) {
            window.addEventListener('deviceorientation', (e) => {
                const gamma = e.gamma || 0;  // left-right tilt
                const beta = e.beta || 0;    // front-back tilt
                
                const rotateX = beta / 15;
                const rotateY = gamma / 15;
                
                mainContainer.style.transform = 
                    `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg)`;
            });
        }

        // ========================================
        // PARTICLE SYSTEM (3-tier)
        // ========================================
        
        function createParticles() {
            const particleSystem = document.getElementById('particleSystem');
            let particleCount = 0;
            
            // Slow particles (15)
            for (let i = 0; i < 15; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle slow';
                
                const leftPos = Math.random() * 100;
                const duration = 12 + Math.random() * 10;
                const delay = Math.random() * 15;
                const drift = (Math.random() - 0.5) * 80;
                
                particle.style.left = leftPos + '%';
                particle.style.animationDuration = duration + 's';
                particle.style.animationDelay = delay + 's';
                particle.style.setProperty('--particle-drift', drift + 'px');
                
                particleSystem.appendChild(particle);
                particleCount++;
            }
            
            // Fast particles (12)
            for (let i = 0; i < 12; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle fast';
                
                const leftPos = Math.random() * 100;
                const duration = 8 + Math.random() * 6;
                const delay = Math.random() * 10;
                const drift = (Math.random() - 0.5) * 100;
                
                particle.style.left = leftPos + '%';
                particle.style.animationDuration = duration + 's';
                particle.style.animationDelay = delay + 's';
                particle.style.setProperty('--particle-drift', drift + 'px');
                
                particleSystem.appendChild(particle);
                particleCount++;
            }
            
            // Glow particles (8)
            for (let i = 0; i < 8; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle glow';
                
                const leftPos = Math.random() * 100;
                const duration = 10 + Math.random() * 8;
                const delay = Math.random() * 12;
                const drift = (Math.random() - 0.5) * 120;
                
                particle.style.left = leftPos + '%';
                particle.style.animationDuration = duration + 's';
                particle.style.animationDelay = delay + 's';
                particle.style.setProperty('--particle-drift', drift + 'px');
                
                particleSystem.appendChild(particle);
                particleCount++;
            }
            
            if (DEBUG) updateDebug('Particles', particleCount + ' created');
        }

        // ========================================
        // CLOUD SYSTEM (3 layers + quote clouds)
        // ========================================
        
        const healingQuotes = [
            "real love doesn't\nkeep score...",
            "you don't have to be strong\nto be worthy...",
            "maybe it's time\nto be soft...",
            "strength became your default\nbecause weakness wasn't safe...",
            "you're not failing —\nyou're protecting...",
            "this isn't weakness —\nthis is grief...",
            "you don't owe anyone anything\nfor being chosen...",
            "you're allowed to be\nuncertain...",
            "what if this is exactly\nwhere you need to be?",
            "your truth matters,\neven when it's quiet...",
            "healing isn't linear,\nand that's okay...",
            "you're doing better\nthan you think...",
            "being seen\ndoesn't require being perfect...",
            "your feelings\nare valid...",
            "it's okay to not be okay\nright now...",
            "being soft\nis not the same\nas being weak...",
            "you are allowed\nto take up space...",
            "your journey\nis uniquely yours..."
        ];
        
        function createCloudLayers() {
            const layers = [
                { 
                    container: document.getElementById('cloudLayerBack'), 
                    count: 8, 
                    speedRange: [35, 45], 
                    sizeRange: [80, 120], 
                    opacity: 0.3 
                },
                { 
                    container: document.getElementById('cloudLayerMid'), 
                    count: 6, 
                    speedRange: [25, 35], 
                    sizeRange: [100, 150], 
                    opacity: 0.5 
                },
                { 
                    container: document.getElementById('cloudLayerFront'), 
                    count: 5, 
                    speedRange: [15, 25], 
                    sizeRange: [120, 180], 
                    opacity: 0.7 
                }
            ];
            
            let cloudCount = 0;
            
            layers.forEach(layer => {
                for (let i = 0; i < layer.count; i++) {
                    const cloud = document.createElement('div');
                    cloud.className = 'parallax-cloud';
                    
                    const leftPos = Math.random() * 95;
                    const duration = layer.speedRange[0] + Math.random() * (layer.speedRange[1] - layer.speedRange[0]);
                    const delay = Math.random() * 30;
                    const size = layer.sizeRange[0] + Math.random() * (layer.sizeRange[1] - layer.sizeRange[0]);
                    const drift = (Math.random() - 0.3) * 120;
                    const rotate = (Math.random() - 0.5) * 15;
                    
                    cloud.style.left = leftPos + '%';
                    cloud.style.width = size + 'px';
                    cloud.style.height = (size * 0.6) + 'px';
                    cloud.style.animationDuration = duration + 's';
                    cloud.style.animationDelay = delay + 's';
                    cloud.style.setProperty('--cloud-opacity', layer.opacity);
                    cloud.style.setProperty('--cloud-drift', drift + '%');
                    cloud.style.setProperty('--cloud-rotate', rotate + 'deg');
                    
                    layer.container.appendChild(cloud);
                    cloudCount++;
                }
            });
            
            if (DEBUG) updateDebug('Clouds', cloudCount + ' parallax clouds created');
        }
        
        function createQuoteClouds() {
            const frontLayer = document.getElementById('cloudLayerFront');
            const quoteCount = 8;
            
            for (let i = 0; i < quoteCount; i++) {
                const cloud = document.createElement('div');
                cloud.className = 'quote-cloud';
                cloud.textContent = healingQuotes[Math.floor(Math.random() * healingQuotes.length)];
                
                const leftPos = Math.random() * 95;
                const duration = 20 + Math.random() * 15;
                const delay = Math.random() * 25;
                const drift = (Math.random() - 0.4) * 130;
                const rotate = (Math.random() - 0.5) * 18;
                
                cloud.style.left = leftPos + '%';
                cloud.style.animationDuration = duration + 's';
                cloud.style.animationDelay = delay + 's';
                cloud.style.setProperty('--quote-drift', drift + '%');
                cloud.style.setProperty('--quote-rotate', rotate + 'deg');
                
                frontLayer.appendChild(cloud);
            }
            
            if (DEBUG) updateDebug('Clouds', '8 quote clouds added');
        }

        // ========================================
        // SPARKLE INTERVALS
        // ========================================
        
        function addSparkle() {
            if (Math.random() > 0.4) {
                const sparkle = document.createElement('div');
                sparkle.className = 'sparkle-float';
                sparkle.textContent = Math.random() > 0.5 ? '✨' : '💫';
                
                sparkle.style.left = Math.random() * 100 + '%';
                sparkle.style.top = Math.random() * 100 + '%';
                
                document.body.appendChild(sparkle);
                setTimeout(() => sparkle.remove(), 8000);
            }
        }
        
        setInterval(addSparkle, 3500);

        // ========================================
        // CELEBRATION PARTICLE BURST
        // ========================================
        
        function createCelebrationBurst() {
            const particleSystem = document.getElementById('particleSystem');
            
            for (let i = 0; i < 30; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle glow';
                
                const centerX = 50;
                const angle = (360 / 30) * i;
                const distance = 5 + Math.random() * 15;
                
                const leftPos = centerX + Math.cos(angle * Math.PI / 180) * distance;
                const duration = 2 + Math.random() * 2;
                const drift = (Math.random() - 0.5) * 200;
                
                particle.style.left = leftPos + '%';
                particle.style.bottom = '50%';
                particle.style.animationDuration = duration + 's';
                particle.style.animationDelay = '0s';
                particle.style.setProperty('--particle-drift', drift + 'px');
                
                particleSystem.appendChild(particle);
                
                setTimeout(() => particle.remove(), duration * 1000);
            }
            
            log('🎉 Celebration burst created!');
        }

        // ========================================
        // INITIALIZE ALL EFFECTS
        // ========================================
        
        createParticles();
        createCloudLayers();
        createQuoteClouds();
        
        log('✨ All magical effects initialized');

        // ========================================
        // MAIN SUBMISSION LOGIC
        // ========================================
        
        let currentUserInput = '';

        async function submitThought() {
            const input = document.getElementById('userInput').value.trim();
            
            if (!input) {
                alert('share something first, love 💛');
                return;
            }

            if (WEBHOOK_URL === 'YOUR_CLOUDFLARE_WORKER_URL_HERE') {
                alert('⚠️ Worker URL not configured yet!\n\nPlease update WEBHOOK_URL in the code with your Cloudflare Worker URL.');
                return;
            }

            currentUserInput = input;
            log('Submitting:', input);
            
            if (DEBUG) {
                updateDebug('Status', 'Submitting...');
                updateDebug('Time', new Date().toLocaleTimeString());
            }

            // Hide submission form
            document.getElementById('submissionView').classList.remove('active');
            
            // Show loading with sequential messages
            document.getElementById('loadingView').classList.add('active');
            showSequentialLoading();
            
            try {
                log('Calling worker at:', WEBHOOK_URL);
                
                const startTime = Date.now();
                const response = await fetch(WEBHOOK_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        original_text: input,
                        user_ip: 'browser'
                    })
                });

                const responseTime = Date.now() - startTime;
                log('Response status:', response.status, 'Time:', responseTime + 'ms');
                
                if (DEBUG) {
                    updateDebug('Status', 'Received (' + responseTime + 'ms)');
                    updateDebug('Time', new Date().toLocaleTimeString());
                }
                
                const responseText = await response.text();
                log('Response text:', responseText);
                
                let data;
                try {
                    data = JSON.parse(responseText);
                } catch (e) {
                    throw new Error('Server returned invalid JSON: ' + responseText.substring(0, 100));
                }
                
                log('Parsed data:', data);
                
                if (DEBUG) {
                    updateDebug('Response', data);
                }
                
                // Hide loading
                hideSequentialLoading();
                document.getElementById('loadingView').classList.remove('active');

                // Handle errors
                if (data.error) {
                    log('Error from server:', data.error);
                    if (DEBUG) updateDebug('Error', data.error + ': ' + data.message);
                    
                    alert(data.message + (data.debug ? '\n\nDebug: ' + data.debug : ''));
                    document.getElementById('submissionView').classList.add('active');
                    return;
                }
                
                if (!data.success || !data.transformed) {
                    throw new Error('Invalid response format from server');
                }
                
                // Show user's original input
                document.getElementById('userInputDisplay').innerText = `"${currentUserInput}"`;
                
                // Show AI transformation
                document.getElementById('transformedText').innerText = data.transformed;
                
                log('Success! Showing result view');
                
                if (DEBUG) {
                    updateDebug('Status', 'Success! ✨');
                    updateDebug('Error', 'None');
                }
                
                // Show result
                document.getElementById('resultView').classList.add('active');
                
                // CELEBRATION BURST! 🎉
                createCelebrationBurst();
                
                // Scroll to top
                window.scrollTo({ top: 0, behavior: 'smooth' });

            } catch (error) {
                console.error('❌ Error:', error);
                log('Full error:', error);
                
                hideSequentialLoading();
                document.getElementById('loadingView').classList.remove('active');
                
                if (DEBUG) {
                    updateDebug('Status', 'Error');
                    updateDebug('Error', error.message);
                }
                
                let errorMessage = 'something went wrong. please try again 💛';
                if (DEBUG) {
                    errorMessage += '\n\nDebug info:\n' + error.message;
                }
                
                alert(errorMessage);
                document.getElementById('submissionView').classList.add('active');
            }
        }

        // ========================================
        // SHARE FUNCTIONS
        // ========================================

        async function shareToSocial() {
            const canvas = createStoryCanvas();
            
            canvas.toBlob(async (blob) => {
                if (navigator.share && navigator.canShare) {
                    try {
                        const file = new File([blob], 'magicmirror-truth.png', { type: 'image/png' });
                        
                        if (navigator.canShare({ files: [file] })) {
                            await navigator.share({
                                files: [file],
                                title: 'my truth, transformed',
                                text: 'shared from magicmirror 🪞✨'
                            });
                            
                            setTimeout(() => {
                                alert('🌸 sharing complete!\n\nif you chose tiktok, tap "story" to share 💛');
                            }, 300);
                            return;
                        }
                    } catch (error) {
                        log('Share cancelled or failed:', error);
                    }
                }
                
                // Fallback to download
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `magicmirror-${Date.now()}.png`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                setTimeout(() => {
                    alert('💛 image saved!\n\nopen tiktok → tap + → upload → select image → story\n\nshare your truth 🪞✨');
                }, 100);
            }, 'image/png', 0.95);
        }

        function downloadArt() {
            const canvas = createStoryCanvas();
            
            canvas.toBlob((blob) => {
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `magicmirror-${Date.now()}.png`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                setTimeout(() => {
                    alert('🎨 your reflection has been saved!\n\nshare it if it speaks to you 💛');
                }, 100);
            }, 'image/png', 0.95);
        }

        function createStoryCanvas() {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            canvas.width = 1080;
            canvas.height = 1920;
            
            // Holographic dreamy gradient background - deeper blues/purples
            const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
            gradient.addColorStop(0, '#B8A8D8');
            gradient.addColorStop(0.25, '#A8B8E8');
            gradient.addColorStop(0.5, '#B8A8E8');
            gradient.addColorStop(0.75, '#C8B8E8');
            gradient.addColorStop(1, '#B8A8D8');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Subtle texture
            ctx.globalAlpha = 0.03;
            for (let i = 0; i < canvas.width; i += 3) {
                ctx.strokeStyle = '#fff';
                ctx.beginPath();
                ctx.moveTo(i, 0);
                ctx.lineTo(i, canvas.height);
                ctx.stroke();
            }
            ctx.globalAlpha = 1;
            
            // Glass card
            const margin = 100;
            const cardPadding = 60;
            const cardX = margin;
            const cardY = margin + 80;
            const cardWidth = canvas.width - (margin * 2);
            const cardHeight = canvas.height - (margin * 2) - 160;
            
            ctx.shadowColor = 'rgba(0, 0, 0, 0.15)';
            ctx.shadowBlur = 40;
            ctx.shadowOffsetY = 20;
            ctx.fillStyle = 'rgba(255, 255, 255, 0.45)';
            ctx.beginPath();
            ctx.roundRect(cardX, cardY, cardWidth, cardHeight, 30);
            ctx.fill();
            ctx.shadowColor = 'transparent';
            
            // Text rendering
            const transformedText = document.getElementById('transformedText').innerText;
            const lines = transformedText.split('\n').filter(line => line.trim());
            
            ctx.fillStyle = '#2d3748';
            ctx.font = 'italic 38px Inter, -apple-system, sans-serif';
            ctx.textAlign = 'left';
            ctx.textBaseline = 'top';
            
            function wrapText(lines, x, y, maxWidth, lineHeight) {
                let currentY = y;
                
                lines.forEach((line, index) => {
                    const words = line.split(' ');
                    let currentLine = '';
                    
                    words.forEach((word) => {
                        const testLine = currentLine + word + ' ';
                        const metrics = ctx.measureText(testLine);
                        
                        if (metrics.width > maxWidth && currentLine !== '') {
                            ctx.fillText(currentLine.trim(), x, currentY);
                            currentLine = word + ' ';
                            currentY += lineHeight;
                        } else {
                            currentLine = testLine;
                        }
                    });
                    
                    ctx.fillText(currentLine.trim(), x, currentY);
                    currentY += lineHeight;
                    
                    if (index < lines.length - 1 && lines[index + 1].trim() === '') {
                        currentY += lineHeight * 0.5;
                    }
                });
                
                return currentY;
            }
            
            const textX = cardX + cardPadding;
            const textY = cardY + cardPadding;
            const textMaxWidth = cardWidth - (cardPadding * 2);
            const lineHeight = 52;
            
            wrapText(lines, textX, textY, textMaxWidth, lineHeight);
            
            // Signature line
            ctx.strokeStyle = 'rgba(0, 0, 0, 0.1)';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(cardX + 80, cardY + cardHeight - 120);
            ctx.lineTo(cardX + cardWidth - 80, cardY + cardHeight - 120);
            ctx.stroke();
            
            // Signature text
            ctx.textAlign = 'center';
            ctx.font = '24px Inter, -apple-system, sans-serif';
            ctx.fillStyle = 'rgba(45, 55, 72, 0.65)';
            ctx.fillText('transformed with love by magicmirror 🪞✨', 
                canvas.width / 2, cardY + cardHeight - 80);
            
            ctx.font = '20px Inter, -apple-system, sans-serif';
            ctx.fillStyle = 'rgba(45, 55, 72, 0.55)';
            ctx.fillText('@withouttoomuchthought', 
                canvas.width / 2, cardY + cardHeight - 45);
            
            return canvas;
        }

        function tryAgain() {
            document.getElementById('resultView').classList.remove('active');
            document.getElementById('submissionView').classList.add('active');
            document.getElementById('userInput').value = '';
            currentUserInput = '';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // ========================================
        // EVENT LISTENERS
        // ========================================

        // Enter key submits
        document.getElementById('userInput').addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                submitThought();
            }
        });

        // Show debug info on load if in debug mode
        if (DEBUG) {
            console.log('🪞 magicmirror debug mode enabled');
            console.log('✨ All features loaded:');
            console.log('   - Rotating placeholder text');
            console.log('   - Sequential loading messages');
            console.log('   - Custom cursor (desktop)');
            console.log('   - Aurora light beams');
            console.log('   - Ripple effects');
            console.log('   - 3-tier particle system');
            console.log('   - 3-layer parallax clouds');
            console.log('   - Healing quote clouds');
            console.log('   - Sparkle intervals');
            console.log('   - 3D card tilt');
            console.log('   - Celebration particle burst');
            console.log('   - Time-based gradients');
            console.log('   - Buy Me a Coffee integration');
            console.log('   - Debug panel');
            console.log('');
            console.log('Add ?debug=true to URL to see the debug panel');
        }
    </script>
</body>
</html>